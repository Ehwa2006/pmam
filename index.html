<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>골목 AR 스탬프 투어</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <link rel="stylesheet" href="style.css" />
  <script src="https://unpkg.com/html5-qrcode"></script>

  <!-- ✅ data.js를 먼저 -->
  <script src="data.js"></script>
</head>

<body>

<header>
  <h1>📍 골목 AR 스탬프 투어</h1>
  <p>QR을 스캔하고 이야기를 수집하세요</p>
</header>

<main>
  <button id="switchCamBtn">🔄 카메라 전환</button>

  <section id="qrSection">
    <div id="reader"></div>
    <p id="status">카메라 준비 중...</p>
  </section>

  <section id="myStamps">
    <h2>🏆 내 스탬프</h2>
    <div id="stampList"></div>
  </section>
</main>

<!-- ✅ QR 로직은 맨 아래 -->
<script>
let qr;
let lastScanTime = 0;        // ⏱ 마지막 인식 시점
const SCAN_COOLDOWN = 3000; // 3초 제한

window.addEventListener("DOMContentLoaded", async () => {
  qr = new Html5Qrcode("reader");

  await qr.start(
    { facingMode: "environment" }, // ✅ 후면 카메라 고정
    {
      fps: 10,
      qrbox: { width: 220, height: 220 }
    },
    (qrText) => {
      const now = Date.now();

      // 🔒 3초 쿨다운
      if (now - lastScanTime < SCAN_COOLDOWN) return;
      lastScanTime = now;

      const scanned = qrText.trim();
      const spot = Object.values(SPOTS).find(s => s.qr === scanned);
      if (!spot) return;

      console.log("✅ QR 인식:", spot.id);
      navigator.vibrate?.(120);

      sessionStorage.setItem("currentSpot", spot.id);

      // ⏳ Safari 안정성용 약간의 딜레이
      setTimeout(() => {
        window.location.href = "ar.html";
      }, 300);
    }
  );
});
</script>






<script src="app.js"></script>
<script src="index-stamps.js"></script>

</body>
</html>
