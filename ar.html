<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>AR</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <script src="https://unpkg.com/aframe"></script>
  <script src="https://unpkg.com/mind-ar@1.2.5/dist/mindar-image-aframe.prod.js"></script>
  <script src="data.js"></script>

  <style>
    body { margin: 0; overflow: hidden; }
  </style>
</head>

<body>

<a-scene
  id="scene"
  embedded
  mindar-image="imageTargetSrc: assets/targets/bridges.mind;"
  vr-mode-ui="enabled:false"
  device-orientation-permission-ui="enabled:false">

  <a-camera position="0 0 0" look-controls="enabled:false"></a-camera>

  <!-- ‚úÖ Í∞Å ÌÉÄÍ≤üÏóê ÏµúÏÜåÌïúÏùò child ÌïÑÏöî -->
  <a-entity mindar-image-target="targetIndex: 0" data-id="gwangtong">
    <a-box visible="false"></a-box>
  </a-entity>

  <a-entity mindar-image-target="targetIndex: 1" data-id="jangtong">
    <a-box visible="false"></a-box>
  </a-entity>

  <a-entity mindar-image-target="targetIndex: 2" data-id="supyo">
    <a-box visible="false"></a-box>
  </a-entity>

  <a-entity mindar-image-target="targetIndex: 3" data-id="samil">
    <a-box visible="false"></a-box>
  </a-entity>

  <a-entity mindar-image-target="targetIndex: 4" data-id="sewoon">
    <a-box visible="false"></a-box>
  </a-entity>

</a-scene>

<script>
const sceneEl = document.querySelector("#scene");
const spotId = sessionStorage.getItem("currentSpot");

sceneEl.addEventListener("loaded", () => {
  console.log("AR Ïî¨ Î°úÎìú ÏôÑÎ£å");

  document.querySelectorAll("[mindar-image-target]").forEach(el => {
    const id = el.dataset.id;

    el.addEventListener("targetFound", () => {
      console.log("üéØ Ïù∏ÏãùÎê®:", id);

      if (id !== spotId) {
        console.log("‚ùå ÌòÑÏû¨ Ïä§Ìåü ÏïÑÎãò ‚Üí Î¨¥Ïãú");
        return;
      }

      console.log("‚úÖ ÌòÑÏû¨ Ïä§Ìåü Ïù∏Ïãù ÏÑ±Í≥µ");
    });

    el.addEventListener("targetLost", () => {
      console.log("‚ùé Ïù∏Ïãù Ìï¥Ï†ú:", id);
    });
  });
});
</script>

</body>
</html>
