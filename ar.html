<script>
/* ===============================
   ìŠ¤íŒŸ ì •ë³´ ë¶ˆëŸ¬ì˜¤ê¸°
================================ */
const spotId = sessionStorage.getItem("currentSpot");

if (!spotId || !SPOTS[spotId]) {
  alert("ì˜ëª»ëœ ì ‘ê·¼ì…ë‹ˆë‹¤.");
  location.href = "index.html";
}

const spot = SPOTS[spotId];
const scene = document.getElementById("scene");

/* ===============================
   AR ì”¬ ìƒì„± (ëª¨ë“  ë‹¤ë¦¬ target ì„ ì–¸)
================================ */
scene.setAttribute(
  "mindar-image",
  "imageTargetSrc: assets/targets/bridges.mind;"
);

scene.innerHTML = `
  <a-camera position="0 0 0" look-controls="enabled:false"></a-camera>

  <a-entity mindar-image-target="targetIndex: 0" data-id="gwangtong"></a-entity>
  <a-entity mindar-image-target="targetIndex: 1" data-id="jangtong"></a-entity>
  <a-entity mindar-image-target="targetIndex: 2" data-id="supyo"></a-entity>
  <a-entity mindar-image-target="targetIndex: 3" data-id="samil"></a-entity>
  <a-entity mindar-image-target="targetIndex: 4" data-id="sewoon"></a-entity>
`;

/* ===============================
   ìŠ¤í† ë¦¬ ì¶œë ¥
================================ */
document.getElementById("spotName").innerText = spot.name;
document.getElementById("storyText").innerHTML =
  spot.story.map(t => `<p>${t}</p>`).join("");

const stampBtn = document.getElementById("stampBtn");

/* ===============================
   â­ ì—¬ê¸°ë‹¤ ì¶”ê°€ â­
   í˜„ì¬ ìŠ¤íŒŸë§Œ í™œì„±í™”
================================ */
document.querySelectorAll("[mindar-image-target]").forEach(el => {
  const id = el.dataset.id;

  if (id !== spotId) {
    el.setAttribute("visible", false);
  } else {
    el.addEventListener("targetFound", () => {
      stampBtn.disabled = false;
      stampBtn.classList.add("active");
      stampBtn.innerText = "ìŠ¤íƒ¬í”„ ë°›ê¸°";
    });
  }
});

/* ===============================
   ìŠ¤íƒ¬í”„ ì²˜ë¦¬
================================ */
stampBtn.addEventListener("click", () => {
  const stamps = JSON.parse(localStorage.getItem("stamps") || "[]");

  if (stamps.includes(spotId)) {
    alert("ì´ë¯¸ ìŠ¤íƒ¬í”„ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤.");
    return;
  }

  stamps.push(spotId);
  localStorage.setItem("stamps", JSON.stringify(stamps));

  alert("ğŸ‰ ìŠ¤íƒ¬í”„ íšë“!");
  location.href = "index.html";
});

/* ===============================
   ë’¤ë¡œê°€ê¸°
================================ */
document.getElementById("backBtn").onclick = () => {
  location.href = "index.html";
};
</script>
